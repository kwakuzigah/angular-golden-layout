{"version":3,"file":"golden-layout.directive.js","sourceRoot":"","sources":["../../src/lib/golden-layout.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import * as GoldenLayout from 'golden-layout';\nimport { InjectionToken, HostListener, Directive, KeyValueDiffer, Input, Renderer2, KeyValueDiffers, ElementRef, ViewContainerRef, Injector,\n Optional, ViewChild, Inject, SimpleChanges, OnInit, DoCheck, OnChanges, OnDestroy, NgZone, ReflectiveInjector, ComponentFactoryResolver, EventEmitter, Output } from '@angular/core';\n\nimport { GOLDEN_LAYOUT_CONFIG } from './golden-layout.interfaces';\n\nimport { GoldenLayoutEvents, GoldenLayoutConfig, GoldenLayoutComponentDefinition } from './golden-layout.interfaces';\n\nexport const GoldenLayoutContainer = new InjectionToken('GoldenLayoutContainer');\nexport const GoldenLayoutComponentState = new InjectionToken('GoldenLayoutComponentState');\nconst COMPONENT_REF_KEY = '$componentRef';\n\n@Directive({\n  selector: '[golden-layout]',\n  exportAs: 'angularGoldenLayout'\n})\nexport class GoldenLayoutDirective  implements OnInit, DoCheck, OnChanges, OnDestroy {\n  private instance: any;\n\n  private configDiff: KeyValueDiffer<string, any>;\n\n  @ViewChild('glroot') private el: ElementRef;\n  @Input() disabled: boolean = false;\n\n  @Input('golden-layout') config: GoldenLayout.Config;\n  private _content: GoldenLayout.ItemConfigType;\n  @Output() contentChange = new EventEmitter();\n  @Input() componentDefinitions: GoldenLayoutComponentDefinition[];\n\n  @Output('initialised'        ) GL_INITIALISED          = new EventEmitter<any>();\n  @Output('stateChanged'       ) GL_STATECHANGED         = new EventEmitter<any>();\n  @Output('windowOpened'       ) GL_WINDOWOPENED         = new EventEmitter<any>();\n  @Output('windowClosed'       ) GL_WINDOWCLOSED         = new EventEmitter<any>();\n  @Output('selectionChanged'   ) GL_SELECTIONCHANGED     = new EventEmitter<any>();\n  @Output('itemDestroyed'      ) GL_ITEMDESTROYED        = new EventEmitter<any>();\n  @Output('itemCreated'        ) GL_ITEMCREATED          = new EventEmitter<any>();\n  @Output('componentCreated'   ) GL_COMPONENTCREATED     = new EventEmitter<any>();\n  @Output('rowCreated'         ) GL_ROWCREATED           = new EventEmitter<any>();\n  @Output('columnCreated'      ) GL_COLUMNCREATED        = new EventEmitter<any>();\n  @Output('stackCreated'       ) GL_STACKCREATED         = new EventEmitter<any>();\n  @Output('tabCreated'         ) GL_TABCREATED           = new EventEmitter<any>();\n\n  constructor(\n    private resolver: ComponentFactoryResolver, \n    private zone: NgZone, \n    private renderer: Renderer2,\n    private elementRef: ElementRef, \n    private differs: KeyValueDiffers,\n    private viewContainer: ViewContainerRef,\n    private readonly injector: Injector,\n    @Optional() @Inject(GOLDEN_LAYOUT_CONFIG) private defaults: GoldenLayoutConfig)\n  {\n    const gl = GoldenLayout;\n  }\n\n  ngOnInit() {\n    const params = new GoldenLayoutConfig(this.defaults);\n\n    params.assign(this.config); \n    params.assign({content: this.content});\n\n    this.zone.runOutsideAngular(() => {\n      this.instance = new GoldenLayout(params, this.elementRef.nativeElement);\n      this.instance.eventHub.on( 'stateChanged', () => {\n        this.content = this.instance.toConfig().content;\n      });\n\n      this.instance.eventHub.on('itemDestroyed', (item: any) => {\n        const container = item.container;\n        const component = container && container[COMPONENT_REF_KEY];\n        if (component) {\n          component.destroy();\n          (container as any)[COMPONENT_REF_KEY] = null;\n        }\n      });\n    });\n\n    // Add native Golden Layout event handling\n    GoldenLayoutEvents.forEach((eventName) => {\n      this.instance.on(eventName.toLowerCase(), (...args) => {\n        args = (args.length === 1) ? args[0] : args;\n\n        if (this[`GL_${eventName.toUpperCase()}`]) {\n          this.zone.run(() => {\n            this[`GL_${eventName.toUpperCase()}`].emit(args);\n          });\n        }\n      });\n    });\n\n    if (!this.configDiff) {\n      this.configDiff = this.differs.find(this.config || {}).create();\n\n      this.configDiff.diff(this.config || {});\n    }\n  }\n\n  ngAfterViewInit(): void {\n    this.componentDefinitions.forEach(componentDefinition => {\n      this.registerComponent(componentDefinition);\n    });\n    this.init();\n  }\n\n  public init() {\n    //init golden layout\n    this.zone.runOutsideAngular(() => {\n      this.instance.init();\n    });\n  }\n\n  set content(val) {\n    this._content = val;\n    this.contentChange.emit(this._content);\n  }\n\n  @Input()\n  get content() {\n    return this._content;\n  }\n\n  public updateSize(width: number, height: number): void {\n    if (this.instance) {\n      this.instance.updateSize(width, height);\n    }\n  }\n\n  // public getComponent(name: string): void {\n  //   if (this.instance) {\n  //     this.instance.getComponent(name);\n  //   }\n  // }\n\n  public registerComponent(goldenLayoutComponentDefinitions: GoldenLayoutComponentDefinition) {\n\n    this.instance.registerComponent(goldenLayoutComponentDefinitions.componentName, (container: GoldenLayout.Container, componentState: any) => {\n       this.zone.run(() => {\n        // Inputs need to be in the following format to be resolved properly\n        // let inputProviders = Object.keys(componentState).map((inputName) => {return {provide: inputName, useValue: componentState[inputName]};});\n        // inputProviders.push({\n        //     provide: GoldenLayoutContainer,\n        //     useValue: container\n        //   });\n          // console.log('inputProviders', inputProviders)\n        const injector = this._createComponentInjector(container, componentState);\n        const factory = this.resolver.resolveComponentFactory(goldenLayoutComponentDefinitions.componentType);\n        const componentRef = this.viewContainer.createComponent(factory, undefined, injector);\n        // (componentRef.instance).data = componentState;\n          // console.log('componentState', componentState)\n\n        // Bind the new component to container's client DOM element.\n        container.getElement().append($(componentRef.location.nativeElement));\n        componentRef.changeDetectorRef.detectChanges();\n\n        // this._bindEventHooks(container, componentRef.instance);\n\n        // Store a ref to the componentRef in the container to support destruction later on.\n        (container as any)[COMPONENT_REF_KEY] = componentRef;\n\n        // // We create an injector out of the data we want to pass down and this components injector\n        // // let injector = ReflectiveInjector.fromResolvedProviders(resolvedInputs, container.parentInjector);\n        \n        // // We create a factory out of the component we want to create\n        // let factory = this.resolver.resolveComponentFactory(componentClass);\n        \n        // // We create the component using the factory and the injector\n        // let component = factory.create(injector);\n\n        // // We insert the component into the dom container\n        // console.log('>>>> created component', component)\n        // container.insert(component.hostView);\n       });\n    });\n  }\n\n  private _createComponentInjector(container: GoldenLayout.Container, componentState: any): Injector {\n    return ReflectiveInjector.resolveAndCreate([\n      {\n        provide: GoldenLayoutContainer,\n        useValue: container\n      },\n      {\n        provide: GoldenLayoutComponentState,\n        useValue: componentState\n      },\n    ], this.injector);\n  }\n\n  ngDoCheck() {\n    if (!this.disabled && this.configDiff) {\n      const changes = this.configDiff.diff(this.config || {});\n\n      if (changes && this.instance) {\n        this.ngOnDestroy();\n\n        this.ngOnInit();\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.instance) {\n      this.zone.runOutsideAngular(() => {\n        this.instance.destroy();\n      });\n\n      this.instance = null;\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges) {\n    if (this.instance && changes['disabled']) {\n      if (changes['disabled'].currentValue !== changes['disabled'].previousValue) {\n        if (changes['disabled'].currentValue === false) {\n          this.zone.runOutsideAngular(() => {\n            this.instance.enable();\n          });\n        } else if (changes['disabled'].currentValue === true) {\n          this.zone.runOutsideAngular(() => {\n            this.instance.disable();\n          });\n        }\n      }\n    }\n  }\n\n  public goldenLayout(): any {\n    return this.instance;\n  }\n}"]}